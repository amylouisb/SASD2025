# Code Smell: Middle Man

## ความหมายของ Code Smell: Middle Man

**Middle Man** คือ code smell ที่เกิดขึ้นเมื่อมีคลาสหนึ่งทำหน้าที่เป็นแค่ตัวกลาง คอยเรียกหรือส่งต่อเมธอดไปยังอีกคลาสหนึ่ง โดยแทบไม่มี logic ของตัวเองเลย ซึ่งทำให้โค้ดมีชั้นการทำงานเพิ่มขึ้นโดยไม่จำเป็น และไม่ได้ช่วยให้ระบบดีขึ้นจริง

ผลกระทบที่มักจะเกิดขึ้น เช่น

* โค้ดยาวขึ้นและอ่านเข้าใจยากกว่าเดิม
* เวลาแก้ไขต้องตามแก้หลายจุด ทั้งที่ควรแก้แค่ที่เดียว
* โครงสร้าง dependency ของระบบดูซับซ้อนเกินความจำเป็น

---

## ตัวอย่างโค้ดที่เกิด Code Smell (Middle Man)

```java
class Order {
    private Customer customer;

    public String getCustomerName() {
        return customer.getName();
    }

    public String getCustomerEmail() {
        return customer.getEmail();
    }
}
```

```java
class Customer {
    private String name;
    private String email;

    public String getName() {
        return name;
    }

    public String getEmail() {
        return email;
    }
}
```

ปัญหาของโค้ดชุดนี้คือ

* คลาส `Order` ไม่มี logic ของตัวเองเลย ทำหน้าที่แค่เรียกเมธอดของ `Customer`
* ถ้าต้องการข้อมูลของลูกค้าเพิ่ม ก็ต้องเพิ่มเมธอดใน `Order` ทุกครั้ง ทำให้โค้ดบวมโดยไม่จำเป็น

---

## c) ตัวอย่างโค้ดหลัง Refactoring แล้ว

แนวทางที่ใช้บ่อยในการแก้ปัญหานี้คือ **Remove Middle Man** โดยให้ฝั่งที่เรียกใช้งาน (client) เข้าถึง `Customer` โดยตรง

```java
class Order {
    private Customer customer;

    public Customer getCustomer() {
        return customer;
    }
}
```

ตัวอย่างการเรียกใช้งาน:

```java
order.getCustomer().getName();
order.getCustomer().getEmail();
```

หลังจาก refactor แล้ว

* ลดเมธอดที่ไม่จำเป็นออกไป
* โค้ดกระชับและอ่านเข้าใจง่ายขึ้น
* ความซับซ้อนของ dependency ลดลง

---

## d) กรณีที่ Middle Man ไม่ได้หมายความว่าโค้ดมีปัญหา

(กรณีที่ไม่จำเป็นต้อง refactoring)

Middle Man **ไม่ได้เป็น code smell ที่ผิดเสมอไป** ในบางสถานการณ์ การมีคลาสตัวกลางถือว่าเหมาะสมกับการออกแบบระบบ เช่น

### 1. ต้องการซ่อนโครงสร้างภายใน (Encapsulation)

```java
public String getCustomerName() {
    return customer.getName();
}
```

* ช่วยไม่ให้ client ต้องรู้โครงสร้างของ `Customer` โดยตรง
* หากมีการเปลี่ยนแปลงภายใน ก็ไม่กระทบกับส่วนที่เรียกใช้งาน

### 2. ใช้เป็น Facade หรือ API Layer

* คลาสในระดับ Controller หรือ Service มักทำหน้าที่เป็นตัวกลางอยู่แล้ว
* ช่วยควบคุมการเข้าถึงและจัดการลำดับการทำงานของระบบ

### 3. มีแนวโน้มจะเพิ่ม logic ในอนาคต

* ปัจจุบันอาจเป็นแค่การ delegate
* แต่ในอนาคตอาจต้องเพิ่ม validation, logging หรือการตรวจสอบสิทธิ์

---

## สรุป

* **Middle Man** คือ code smell ที่เกิดจากคลาสที่ทำหน้าที่แค่ส่งต่อการเรียกใช้งาน
* ควรพิจารณา refactor เมื่อ:

  * ไม่มี logic ที่เพิ่มคุณค่าให้ระบบ
  * ทำให้โค้ดซับซ้อนโดยไม่จำเป็น
* แต่ไม่ควร refactor เมื่อ:

  * ต้องการ encapsulation
  * ใช้เป็น facade หรือ API boundary
  * มีเหตุผลด้านการออกแบบในระยะยาว

> ❝ Code smell เป็นแค่สัญญาณเตือน ไม่ได้หมายความว่าโค้ดนั้นผิดเสมอไป ❞
